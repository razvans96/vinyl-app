"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9050],{76:(f,d,r)=>{r.d(d,{GW:()=>s,dk:()=>i,oK:()=>a});var a=(()=>((a=a||{}).Prompt="PROMPT",a.Camera="CAMERA",a.Photos="PHOTOS",a))(),s=(()=>((s=s||{}).Rear="REAR",s.Front="FRONT",s))(),i=(()=>((i=i||{}).Uri="uri",i.Base64="base64",i.DataUrl="dataUrl",i))()},9050:(f,d,r)=>{r.r(d),r.d(d,{AddSongPageModule:()=>I});var a=r(4755),s=r(5030),i=r(712),g=r(237),h=r(5861),y=r(6090),p=r(7423),v=r(76);const P=(0,p.fo)("Camera",{web:()=>r.e(3954).then(r.bind(r,3954)).then(e=>new e.CameraWeb)});var t=r(3020),A=r(5830),S=r(7556),Z=r(6550);function T(e,l){1&e&&t._UZ(0,"ion-input",16)}function U(e,l){1&e&&(t.TgZ(0,"span",17),t._uU(1,"Se ha tomado la foto correctamente"),t.qZA())}const C=[{path:"",component:(()=>{class e{constructor(o,n,u,m,F){this.apiService=o,this.authService=n,this.router=u,this.formBuilder=m,this.sanitizer=F,this.song={_id:"",title:"",artist:"",date:new Date,photo:"",photobase64:"",location:{latitude:0,longitude:0,accuracy:0},user:""},this.userId="",this.latitude=0,this.longitude=0,this.accuracy=0,this.photo="",this.convertBlobToBase64=R=>new Promise((B,J)=>{const c=new FileReader;c.onerror=J,c.onload=()=>{B(c.result)},c.readAsDataURL(R)})}ngOnInit(){this.getCurrentPosition(),this.songForm=this.formBuilder.group({title:["",s.kI.required],artist:["",s.kI.required],date:["",s.kI.required],photo:[]})}ionViewWillEnter(){this.getUserId()}getUserId(){this.userId=this.authService.getUserId(),console.log("USUARIO:"+this.userId)}addSong(){if(this.songForm.valid){this.song={_id:"",title:this.songForm.value.title,artist:this.songForm.value.artist,date:this.songForm.value.date,photo:this.songForm.value.photo,photobase64:this.photo,location:{latitude:this.latitude,longitude:this.longitude,accuracy:this.accuracy},user:this.userId},console.log(this.song);try{this.apiService.postSong(this.song).then(o=>{console.log(o),this.router.navigate(["/home"])})}catch(o){console.log(o)}}}takePhoto(){var o=this;return(0,h.Z)(function*(){const n=yield P.getPhoto({quality:90,allowEditing:!1,resultType:v.dk.Uri});n&&o.readAsBase64(n)})()}readAsBase64(o){var n=this;return(0,h.Z)(function*(){const m=yield(yield fetch(o.webPath)).blob();n.photo=yield n.convertBlobToBase64(m)})()}getCurrentPosition(){var o=this;return(0,h.Z)(function*(){if(p.dV.isNativePlatform()){const n=yield y.b.getCurrentPosition();o.latitude=n.coords.latitude,o.longitude=n.coords.longitude,o.accuracy=n.coords.accuracy,console.log("Current position:",o.latitude,o.longitude,o.accuracy)}else navigator.geolocation?navigator.geolocation.getCurrentPosition(n=>{o.latitude=n.coords.latitude,o.longitude=n.coords.longitude,o.accuracy=n.coords.accuracy,console.log("Current position:",o.latitude,o.longitude,o.accuracy)},n=>{console.log("Error getting location:",n)}):console.log("Geolocation is not supported by this browser.")})()}isPhotoEmpty(){return""===this.photo}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(A.s),t.Y36(S.e),t.Y36(g.F0),t.Y36(s.qu),t.Y36(Z.H7))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-add-song"]],decls:26,vars:6,consts:[[1,"ion-no-border",3,"translucent"],["slot","start"],[3,"fullscreen"],["size-md","6","offset-md","3"],[1,"form-box"],[1,"form",3,"formGroup","ngSubmit"],[1,"title"],[1,"subtitle"],["placeholder","Title","type","text","formControlName","title",1,"input"],["placeholder","Artist","type","text","formControlName","artist",1,"input"],["type","date","placeholder","dd/mm/yyyy","formControlName","date",1,"input"],["class","input","placeholder","Photo URL","type","text","formControlName","photo",4,"ngIf"],["slot","end","fill","clear",3,"click"],["name","camera"],["color","success",4,"ngIf"],["type","submit",3,"disabled"],["placeholder","Photo URL","type","text","formControlName","photo",1,"input"],["color","success"]],template:function(o,n){1&o&&(t.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),t._UZ(3,"ion-back-button"),t.qZA()()(),t.TgZ(4,"ion-content",2)(5,"ion-row")(6,"ion-col",3)(7,"div",4)(8,"form",5),t.NdJ("ngSubmit",function(){return n.addSong()}),t.TgZ(9,"span",6),t._uU(10,"Add new song"),t.qZA(),t.TgZ(11,"span",7),t._uU(12,"Fill this form to add a new custom song"),t.qZA(),t.TgZ(13,"ion-item"),t._UZ(14,"ion-input",8),t.qZA(),t.TgZ(15,"ion-item"),t._UZ(16,"ion-input",9),t.qZA(),t.TgZ(17,"ion-item"),t._UZ(18,"ion-input",10),t.qZA(),t.TgZ(19,"ion-item"),t.YNc(20,T,1,0,"ion-input",11),t.TgZ(21,"ion-button",12),t.NdJ("click",function(){return n.takePhoto()}),t._UZ(22,"ion-icon",13),t.qZA()(),t.YNc(23,U,2,0,"span",14),t.TgZ(24,"ion-button",15),t._uU(25,"Submit"),t.qZA()()()()()()),2&o&&(t.Q6J("translucent",!0),t.xp6(4),t.Q6J("fullscreen",!0),t.xp6(4),t.Q6J("formGroup",n.songForm),t.xp6(12),t.Q6J("ngIf",n.isPhotoEmpty()),t.xp6(3),t.Q6J("ngIf",!n.isPhotoEmpty()),t.xp6(1),t.Q6J("disabled",!n.songForm.valid))},dependencies:[a.O5,s._Y,s.JJ,s.JL,s.sg,s.u,i.oU,i.YG,i.Sm,i.wI,i.W2,i.Gu,i.gu,i.pK,i.Ie,i.Nd,i.sr,i.j9,i.cs]}),e})()}];let b=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[g.Bz.forChild(C),g.Bz]}),e})(),I=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[a.ez,s.UX,i.Pc,b]}),e})()}}]);